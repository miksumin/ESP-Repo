2.1.5(20250629)

Добавлена возможность выбора WiFi scan method с помощью команды [wifi_scan_mode] [1/2]. По умолчанию используется режим WIFI_FAST_SCAN [1]. Можно использовать режим WIFI_ALL_CHANNEL_SCAN [2] для выбора сети с бОльшим уровнем сигнала из нескольких доступных сетей с одинаковым SSID. Доработан алгоритм переключения режимов работы Ethernet/WiFi и переключения режимов WiFi (AP/STA/AP_STA). Добавлена режим static IP для Ethernet (eth_address, eth_netmask, eth_gateway, eth_dns). Добавлена проверка доступности Интернет и NTP сервера.

2.1.5(20250226)

Доработан алгоритм работы MQTT Controls. Добавлен параметр [mqtt_control_mode 0/1] для указания режима работы контрола пассивный/активный (slave/master). По умолчанию используется пассивный (slave) режим. В активном (master) режиме происходит управление базовым контролом через топик /SetState.
Добавлена проверка доступности NTP сервера, который используется для синхронизации времени, единственной функции прошивки, требующей наличие доступа к Интернет. В случае отсутствия доступа к серверу данная функция отключается. Добавлена проверка доступности MQTT сервера, что актуально в случае, если используется внешний MQTT-брокер.
Исправлена ошибка и доработан алгоритм чтения данных по шине Opentherm для котлов Viessmann Vitopend-100,
Доработан алгоритм обработки ситуаций, при которых датчик по каким либо причининам прекращает присылать данные.
Добавлена публикация HA Autodiscovery топиков для BLE счетчиков.

2.1.5(20241228)

Переработан функционал для чтения и обработки кнопок, в т.ч. TOUCH sensors и физических кнопок, а также управления дисплеем и контролами.
Для включения работы функционала используется команда [buttons_enable 1]
Для определения кнопки используются следующие команды:
[button_name ИМЯ_КНОПКИ] - произвольное имя кнопки
[button_pin XX] - пин контроллера
[button_type XXXXXXX] - тип используемой кнопки TOUCH/GROUND/POWER/PULLUP, по умолчанию используется значение TOUCH
[button_mode XXXXXXX] - режим работы кнопки BUTTON/SWITCH, по умолчанию используется значение BUTTON
Для назначения функций кнопки используются следующие команды:
[display_scroll_left ИМЯ_КНОПКИ]
[display_scroll_right ИМЯ_КНОПКИ]
[control_source_name ИМЯ_КНОПКИ]

2.1.5(20241225)

Исправлена ошибка перевода котла в режим Idle [Opentherm - OFF] при перезагрузке контроллера. Исправлена ошибка чтения темп ГВС для одноконтурных котлов, которые выдают ее в другом параметре как двухконтурные (например, Baxi Eco). Отключена функция непрерывной записи лог-файла в режиме "сдвига" содержимого по причине большого кол-ва времени, требуемого для полной перезаписи файла при добавлении новой строки при достижении максимального размера файла, что могло приводить к серьезным сбоям в алгоритмах взаимодействия с котлом, которые жестко регламентированы по промежуткам времени между отправкой и получением пакетов данных по шине Opentherm. Вместо этого реализован функционал для автоматического переименования текущего файла лога при достижении им максимального размера в файл "Runtime.bak" и продолжения записи лога в новый файл "Runtime.log". При следующей смене текущего файла лога старый автоматически удалется. Таким образом запись лога не прерывается, а история лога хранится в двух файлах - текущем и предыдущем. Реализована возможность подключения иконки, которая автоматически выводится на закладке веб-браузера, отображающей веб-интерейс прошивки. При отсутствии файла иконки "favicon.ico" он автоматически создается при старте прошивки и может быть заменен любым файлом иконки в соответствующем формате с помощью загрузки файла на странице "Files List". Всевозможные варианты иконок можно найти в Интернете и там же есть инструменты для преобразования графических файлов в формат "*.ico". Обычный размер иконки составляет 16х16 или 32х32 пикселя.

2.1.5(20241220)

Добавлен принудительный апдейт режима работы котла командой термостата, если термостат включен и текущий режим бойлера не соответствует текущей команде термостата. Обработана ошибка чтения Wire-датчика при его отключении.

2.1.5(20241219)

Для работы с дисплеем использована библиотека для чипа SSD1306. Исправлена ошибка в работе алгоритмов отображения информации на дисплее.

2.1.5(20241213)

Доработаны алгоритмы работы с JSON-конфигом и отображения на дисплее при использовании 1-Wire сенсоров.

2.1.5(20241204)

Добавлено определение двухконтурных котлов Buderus Logamax U072-18K/24K/35K
	
2.1.5(20241202)

MQTT-топики для работы механизма HA Autodiscovery теперь обновляются автоматически каждый раз при переподключении к MQTT-брокеру. Исправлена ошибка с работой контролов, настроенных для работы по изменению режимов работы котла.

2.1.5(20241130)

Для включения/выключения режима записи лога в файл без остановки при достижении максимального размера файла (8К) используется команда [log_shift 0/1]. При включении такого режима содержимое файла лога будет "сдвигаться" с удалением самых ранних строк лог-файла и добавлением новых записей. Обращаю ваше внимание, что работа с лог-файлами использует много памяти, поэтому рекомендую вам не увлекаться такими режимами работы, которые в нестандартной ситуации могут привести к сбою в работе прошивки. Используйте такой непрерывный режим записи лога только при необходимости поиска причин некорректного поведения прошивки и своевременно его выключайте. При рестарте записи лога предыдущий файл лога сохраняется с именем "Runtime.bak".

2.1.5(20241125)

Добавлен функционал для сохранения первичных результатов опроса котла в файле в формате JSON, что дает возможность в дальнейшем не выполнять сканирование котла каждый раз при загрузке прошивки или при включении/выключении котла, а использовать результаты предыдущего сканирования, сохраненные в файле "Report.json". Такой более оптимальный режим работы появляется только в случае, если ваш котел предоставляет свой уникальный идентификатор (DataID-127), по которому прошивка может определить, что на связи все тот же котел, а не какой то другой. Для включения режима сохранения данных опроса котла достаточно использовать команду [ot_report 1].

Добавлен функционал для работы с конфигом прошивки, сохраненным в формате JSON, который более удобен для работы с ним как пользователю, так и самой прошивке, которая в этом случае может в автоматическом режиме добавлять/удалять разделы, добавленные или, наоборот, неактуальные в данной конфигурации. Для первичного сохранения текущего конфига прошивки в формате JSON достаточно нажать на соответствующую ссылку на странице "Config" и после перезагрузки именно этот файл конфигурации будет использоваться для редактирования и работы прошивки. При этом старый текстовый файл конфигурации не удаляется и при необходимости всегда может быть открыт для просмотра или загружен пользователем.

Добавлен ранее анонсированный функционал для чтения беспроводных счетчиков газа и воды компании Элехант (https://elehant.ru/catalog). При включенном режиме сканирования и автодобавления BLE устройств ([ble_auto_add 1]) такие счетчики при их обнаружении будут автоматически добавлены и отображены в новом разделе "Counters". Для настройки подключения таких счетчиков в конфиге необходимо указать параметры [ble_counter_name] и [ble_counter_addr] по аналогии с настройкой подключения BLE датчиков. Публикация данных настроенных счетчиков выполняется в отдельном MQTT-топике "/Counters".

2.1.5(20231215)

[Thermo Relays]:
Добавлен параметр [thermos_delta] для определения гистерезиса, одинакового для ВСЕХ Thermo Relays (по умолчанию используется значение 0.1). Добавлен параметр [thermo_delta] для определения гистерезиса для конкретного Thermo Relay (по умолчанию используется значение thermos_delta).

[Thermostat]:
Добавлена возможность использования значений [CH Temp] и [DHW Temp] в качестве значений датчика термостата. Для этого в 
параметре [pid_sensor_name] указываем предопределенные значения [BOILER] и [WATER] соответственно.

[Controls]:
Проведена оптимизация алгоритмов функционала работы Контролов. Для публикации состояния Контрола используются топики /State (0/1) и /Status (ON/OFF). Для управления состоянием Контроля используется топик /SetState (0/1).
Добавлена возможность использования значений [CH Status], [DHW status], [Flame status] и [Fault status] в качестве управляющих значений для конкретного Control-а. Для этого при определении Control добавляем параметр [control_source_name], в котором указываем предопределенные значения [BOILER], [WATER], [FLAME] и [FAULT] соответственно. Для использования значений [CH Mode] и [DHW Mode] в качестве управляющих начений для конкретного Control-а в параметре [control_source_name] указываем предопределенные значения [CHMODE] и [DHWMODE] соответственно.

[MQTT]:
Реализован функционал для нативной интеграции параметров работы прошивки в систему HomeAssistant, который автоматически формирует в HA описание нескольких устройств - это собственно сам контроллер, котел (Boiler), Термостат, BLE датчики и Контролы. Для включения функционала необходимо в конфиге указать параметр [mqtt_HA_discovery 1].

Изменены некоторые топики, а именно: /Thermostat/Temp (ранее /Thermostat/TSet), /Opentherm/CHtemp (ранее /Opentherm/CHTset) и /Opentherm/DHWtemp (ранее /Opentherm/DHWTSet).
Расширенный набор значений общих параметров работы прошивки теперь публикуются в формате JSON в топике /System/Info. Информация о доступности контроллера по прежнему публикуется в топике /System/Online
